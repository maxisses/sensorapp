<!DOCTYPE html>
<html>
<head>
    <title>IBM Cloud Web Starter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    Hallo
    <div id="container">

    </div>
</body>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>


<script>
    console.log(mqtt)

    /* const host = "wss://fevhyi.messsaging.internetofthings.ibmcloud.com"
    const ibm_topic = "iot-2/evt/test/fmt/txt"

    const options = {
        keepalive: 60,
        clientId: "d:fevhyi:smartphone:112233445566",
        port: 443,
        username: 'use-token-auth',
        password: 'banane123',
        protocolId: 'MQTT',
        protocolVersion: 4,
        clean: true,
        reconnectPeriod: 1000,
        connectTimeout: 30 * 1000,
        will: {
            topic: 'WillMsg',
            payload: 'Connection Closed abnormally..!',
            qos: 0,
            retain: false
        },
    }
    
    console.log('Connecting mqtt client')
    const client = mqtt.connect(host, options)
    console.log('Connection initialized')
    client.on('connect', function () {
        client.publish(ibm_topic , 'Hello mqtt')
            }) */

    const host = "ws://localhost"
    const topic = "blub/blub1"
    const clientId = "ICHBINES"

    const options_connect = {
        keepalive: 60,
        clientId: clientId,
        port: 9001,
        username: 'maxisses',
        protocolId: 'MQTT',
        protocolVersion: 4,
        clean: true,
        reconnectPeriod: 1000,
        connectTimeout: 30 * 1000,
        will: {
            topic: 'WillMsg',
            payload: 'Connection Closed abnormally..!',
            qos: 0,
            retain: false
        },
    }
    
    console.log('Connecting to mqtt client')
    var client = mqtt.connect(host, options_connect)
    console.log('Connection initialized')

    client.on('error', function (err) {
        console.log(err)
        client.end()
    })

    client.on('connect', function () {
        console.log('client connected:' + clientId)
        client.subscribe(topic, { qos: 0 })
        client.publish(topic, 'AHHHHHHHHHHHHHHHHHHHHHHHHHHHH', { qos: 0, retain: false })
    })

    client.on("message", function (topic, payload) {
        console.log("new message!!!!!!!!!!!!")
        console.log('Received Message:= ' + payload.toString() + '\nOn topic:= ' + topic)
        client.end()
    })

    client.on('close', function () {
        console.log(clientId + ' disconnected')
    })

    /* client.subscribe(topic, function (err) {
            if (err) {
                console.log("subscription didnt work" + String(err))
            } else {
                console.log("subscribed to topic: " + topic)}
            }) */
    
    /* client.on('connect', function () {
        console.log('success connecting to mqtt-Broker at: '+host)
        client.subscribe(topic, function (err) {
            if (err) {
                console.log("subscription didnt work" + String(err))
            } else {
                var i;
                for (i = 0; i < 10; i++) {
                    client.publish(topic , 'AHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH', function (err) {
                        if (err) {
                            console.log("publish didnt work" + String(err))
                        }else{
                            console.log("published smth to topic: " + topic)
                        }
                    })
                }
            }
        })
    })

    client.on("message", function (topic, payload) {
        console.log("new message!!!!!!!!!!!!")
        alert([topic, payload].join(": "))
        client.end()
    })


    client.on('error', (err) => {
        console.log('Connection error: ', err)
        client.end()
    })

    client.on('reconnect', () => {
        console.log('Reconnecting...')
    }) */
    
</script>



<script>
    let sensor = new window.Gyroscope();
    document.getElementById("container").innerHTML = "initial: " + sensor.x

    sensor.start()

    sensor.onreading = () => {
        document.getElementById("container").innerHTML = "onreading: " + "X:" + sensor.x + "Y:"+ sensor.y + "Z:" + sensor.y;
    }

    sensor.onerror = e => {
        sensor.errorType = `Error: ${e.error.name}`;
        sensor.errorMessage = `Error message: ${e.error.message}`;
        this.requestUpdate('sensorDataModel');
    }

    sensor.onactivate = () => {
        this.requestUpdate('sensorDataModel');
    }; 
    if (window.Accelerometer == undefined) {
        alert("no accelerometer");
    }
    else {
        alert("accelerometer found");
    }

</script>
</html>
